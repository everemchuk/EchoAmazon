---
import App from "@app/App.astro";
import { Button } from "@shared/ui/Button/Button";
import { IconButton } from "@shared/ui/IconButton/IconButton";
import { Toggle } from "@shared/ui/Toggle/Toggle";
import { Tooltip } from "@shared/ui/Tooltip/Tooltip";
import { Icon } from "astro-icon/components";
import pufferJacket from "@shared/assets/images/vecteezy_a-boy-s-puffer-jacket-with-a-hood_53110050.png";
import varsityJacket from "@shared/assets/images/vecteezy_generated-ai-yellow-varsity-jacket-isolated-on-transparent_48767912.png";
import trackJacket from "@shared/assets/images/vecteezy_sporty-black-track-jacket-with-zipper_43023976.png";

// Product data store
const productsData: Record<
	string,
	{
		id: string;
		title: string;
		brand: string;
		category: string;
		price: string;
		rating: number;
		reviews: number;
		image: string;
		description: string;
		sizes: string[];
		colorVariants: { name: string; hex: string }[];
	}
> = {
	"1": {
		id: "1",
		title: "Cashmere Jacket",
		brand: "Brioni",
		category: "Jackets",
		price: "$5,657",
		rating: 4,
		reviews: 28,
		image: pufferJacket.src,
		description:
			"Experience unparalleled luxury with this exquisite cashmere jacket. Crafted from the finest Italian cashmere, this piece represents the pinnacle of sartorial elegance. The timeless design features meticulous hand-stitched detailing, mother of pearl buttons, and a full canvas construction that ensures a perfect drape.",
		sizes: ["XS", "S", "M", "L", "XL"],
		colorVariants: [
			{ name: "Black", hex: "#1a1a1a" },
			{ name: "White", hex: "#f5f5f5" },
		],
	},
	"2": {
		id: "2",
		title: "Varsity Jacket",
		brand: "Nike",
		category: "Jackets",
		price: "$120",
		rating: 3.5,
		reviews: 256,
		image: varsityJacket.src,
		description:
			"A modern take on the classic varsity jacket. This iconic piece combines streetwear aesthetics with athletic heritage, featuring premium materials and contemporary styling.",
		sizes: ["XS", "S", "M", "L", "XL"],
		colorVariants: [
			{ name: "Black", hex: "#1a1a1a" },
			{ name: "White", hex: "#f5f5f5" },
		],
	},
	"3": {
		id: "3",
		title: "Track Jacket",
		brand: "Adidas",
		category: "Sportswear",
		price: "$80",
		rating: 2.5,
		reviews: 342,
		image: trackJacket.src,
		description:
			"The iconic track jacket reimagined for modern athletes. Features a slim fit design with classic three-stripe detailing, perfect for training or casual wear.",
		sizes: ["XS", "S", "M", "L", "XL"],
		colorVariants: [
			{ name: "Black", hex: "#1a1a1a" },
			{ name: "White", hex: "#f5f5f5" },
		],
	},
};

export function getStaticPaths() {
	return [
		{ params: { id: "1" } },
		{ params: { id: "2" } },
		{ params: { id: "3" } },
	];
}

const { id } = Astro.params;
const product = productsData[id] || productsData["1"];
---

<App
	title={`${product.title} by ${product.brand} - EchoAmazon`}
	activePage="store"
>
	<div class="product-page">
		<div class="product-page-content">
			<!-- Product Image Section -->
			<div class="product-image-section">
				<div class="main-image-container">
					<img
						src={product.image}
						alt={product.title}
						class="pp-main-image"
						id="main-product-image"
					/>

					<!-- Image Shadow -->
					<div class="image-shadow"></div>
				</div>

				<!-- Gallery Navigation Indicators -->
				<div class="gallery-indicators">
					<span class="indicator active"></span>
					<span class="indicator"></span>
					<span class="indicator"></span>
				</div>

				<!-- Thumbnail Gallery -->
				<div class="thumbnail-gallery">
					<div class="pp-thumbnail active">
						<img src={product.image} alt="View 1" />
					</div>
					<div class="pp-thumbnail">
						<img src={product.image} alt="View 2" />
					</div>
					<div class="pp-thumbnail">
						<img src={product.image} alt="View 3" />
					</div>
				</div>
			</div>

			<!-- Product Details Section -->
			<div class="product-details-section">
				<!-- Back Toggle -->
				<a href="/store" class="back-toggle-wrapper">
					<Toggle
						id="back-toggle"
						class="back-toggle"
						ariaLabel="Back to store"
						direction="left"
					/>
				</a>

				<div class="pp-header">
					<p class="pp-brand">{product.brand}</p>
					<h1 class="pp-title">{product.title}</h1>

					<div class="pp-rating">
						<div class="stars-wrapper">
							<div class="stars">
								{
									Array.from({ length: 5 }).map((_, i) => {
										if (product.rating >= i + 1) {
											return <Icon name="star" class="star filled" />;
										} else if (product.rating >= i + 0.5) {
											return <Icon name="star-half" class="star filled" />;
										} else {
											return <Icon name="star-outline" class="star empty" />;
										}
									})
								}
							</div>
							<Tooltip
								text={`${product.rating}`}
								position="left"
								color="primary"
							/>
						</div>
						<span class="reviews">{product.reviews} Reviews</span>
					</div>
				</div>

				<div class="pp-description">
					<p>{product.description}</p>
				</div>

				<!-- Color Choice -->
				<div class="pp-color-section">
					<span class="section-label">Color</span>
					<div class="color-options">
						{
							product.colorVariants.map((variant, index) => (
								<button
									class={`color-option ${index === 0 ? "active" : ""}`}
									data-color={variant.name}
									title={variant.name}
								>
									<span
										class="color-swatch"
										style={`background-color: ${variant.hex};`}
									/>
								</button>
							))
						}
					</div>
				</div>

				<!-- Size Selector -->
				<div class="pp-size-section">
					<div class="section-header">
						<span class="section-label">Size</span>
					</div>
					<div class="pp-sizes">
						{
							product.sizes.map((size, index) => (
								<span
									class={`size-option ${index === 2 ? "selected" : ""}`}
									data-size={size}
								>
									{size}
								</span>
							))
						}
					</div>
				</div>

				<!-- Price and Actions -->
				<div class="pp-actions">
					<div class="price-block">
						<span class="label">Best Price</span>
						<span class="price">{product.price}</span>
					</div>
					<div class="action-buttons">
						<Button
							text="Add To Cart"
							color="primary"
							variant="sharp"
							showArrow={true}
							class="add-to-cart-btn"
						/>
						<IconButton
							icon="heart"
							ariaLabel="Add to wishlist"
							class="wishlist-btn"
							variant="outline"
							color="regular"
							shape="rounded"
						/>
					</div>
				</div>

				<!-- Delivery Info -->
				<div class="pp-delivery">
					<div class="delivery-item">
						<div class="delivery-icon">
							<Icon name="truck" size={20} />
						</div>
						<div class="delivery-content">
							<span class="delivery-title">Free Delivery</span>
							<span class="delivery-text"
								>Enter your postal code for delivery availability</span
							>
						</div>
					</div>
					<div class="delivery-item">
						<div class="delivery-icon">
							<Icon name="refresh" size={20} />
						</div>
						<div class="delivery-content">
							<span class="delivery-title">Return Delivery</span>
							<span class="delivery-text"
								>Free 30 days return. <a href="#">Details</a></span
							>
						</div>
					</div>
				</div>

				<!-- Product Features -->
				<div class="pp-features">
					<div class="feature-item">
						<Icon name="shield-check" size={18} />
						<span>Authentic Product</span>
					</div>
					<div class="feature-item">
						<Icon name="package" size={18} />
						<span>Secure Packaging</span>
					</div>
					<div class="feature-item">
						<Icon name="credit-card" size={18} />
						<span>Secure Payment</span>
					</div>
				</div>
			</div>
		</div>
	</div>
</App>

<style lang="sass">
	@use '@shared/styles/vars' as *

	.product-page
		//padding: 2rem
		min-height: 100vh
		display: flex
		flex-direction: column

	// === Back Toggle ===
	// === Back Toggle ===
	.back-toggle-wrapper
		position: absolute
		top: 0
		right: 0
		z-index: 10
		text-decoration: none

	// === Main Content ===
	.product-page-content
		display: flex
		flex-direction: column
		flex-grow: 1
		padding: 1.5rem
		gap: 2rem
		height: 100%

		@include respond-to($tablet)
			flex-direction: row
			padding: 2rem
			gap: 3rem

	// === Product Image Section ===
	.product-image-section
		flex: 1.2
		display: flex
		flex-direction: column
		height: auto
		gap: 1rem
		min-height: 0

		@include respond-to($tablet)
			height: calc(100vh - 4rem)
			position: sticky
			top: 2rem

	.main-image-container
		position: relative
		border-radius: 24px
		padding: 3rem
		display: flex
		align-items: center
		justify-content: center
		flex: 7
		height: 70vh
		min-height: 400px

	.pp-main-image
		max-width: 100%
		max-height: 100%
		object-fit: contain
		filter: drop-shadow(0 15px 30px rgba(0,0,0,0.1))
		transition: transform 0.3s ease

	.image-shadow
		position: absolute
		bottom: 10%
		left: 50%
		transform: translateX(-50%)
		width: 60%
		height: 20px
		background: radial-gradient(ellipse at center, rgba(0,0,0,0.15) 0%, transparent 70%)
		border-radius: 50%

	// === Gallery Indicators ===
	.gallery-indicators
		display: flex
		justify-content: center
		align-items: center
		gap: 0.5rem
		padding: 0.5rem 0

	.indicator
		width: 40px
		height: 4px
		background-color: var(--border-color)
		border-radius: 2px
		cursor: pointer
		transition: width 0.5s cubic-bezier(0.25, 0.8, 0.25, 1), background-color 0.3s ease

		&.active
			width: 60px
			background-color: var(--primary-color)

		&:hover:not(.active)
			background-color: var(--secondary-text-color)

	// === Thumbnail Gallery ===
	.thumbnail-gallery
		display: flex
		gap: 0.75rem
		align-items: stretch
		flex: 3
		min-height: 80px

	.pp-thumbnail
		flex: 1
		max-width: 33.333%
		border-radius: 12px
		overflow: hidden
		cursor: pointer
		border: 1px solid var(--border-color)
		transition: all 0.2s ease
		display: flex
		align-items: center
		justify-content: center
		padding: 8px

		&:hover,
		&.active
			border-color: var(--primary-color)

		img
			max-width: 100%
			max-height: 100%
			object-fit: contain

	// === Product Details Section ===
	.product-details-section
		flex: 1
	.product-details-section
		flex: 1
		display: flex
		flex-direction: column
		justify-content: center
		gap: 1.5rem
		position: relative

	.pp-header
		.pp-brand
			font-size: 0.85rem
			color: var(--secondary-text-color)
			text-transform: uppercase
			letter-spacing: 1.5px
			margin-bottom: 0.5rem

		.pp-title
			font-family: $font-family-heading
			font-size: 2.5rem
			color: var(--text-color)
			margin-bottom: 1rem
			line-height: 1.1
			font-weight: 700

			@include respond-to($tablet)
				font-size: 3rem

		.pp-rating
			display: flex
			align-items: center
			gap: 0.75rem
			color: var(--primary-color)

			.stars-wrapper
				position: relative
				display: flex
				align-items: center
				cursor: pointer

				&:hover
					:global(.tooltip)
						opacity: 1
						visibility: visible
						transform: translateY(-50%) translateX(0)

			.stars
				display: flex
				gap: 0.25rem

			.star
				width: 18px
				height: 18px

				&.empty
					opacity: 0.3

			.reviews
				border: 1px solid var(--primary-color)
				color: var(--primary-color)
				font-size: 0.9rem
				border-radius: 8px
				padding: 8px 12px
				cursor: pointer
				transition: all 0.2s ease
				&:hover
					background-color: var(--primary-color)
					color: var(--text-color)

	.pp-description
		border-radius: 12px
		font-size: 0.95rem
		color: var(--secondary-text-color)
		line-height: 1.7
		max-width: 550px

	// === Section Labels ===
	.section-label
		font-size: 0.85rem
		font-weight: 600
		color: var(--text-color)
		text-transform: uppercase
		letter-spacing: 0.5px

	.section-header
		display: flex
		align-items: center
		justify-content: space-between
		margin-bottom: 0.5rem

		&:hover
			opacity: 0.8

	// === Color Section ===
	.pp-color-section
		display: flex
		flex-direction: column
		gap: 0.75rem

	.color-options
		display: flex
		gap: 0.75rem

	.color-option
		display: flex
		align-items: center
		justify-content: center
		padding: 4px
		border: 1px solid var(--border-color)
		border-radius: 8px
		background: transparent
		cursor: pointer
		transition: all 0.2s ease

		&:hover,
		&.active
			border-color: var(--primary-color)

	.color-swatch
		width: 32px
		height: 32px
		border-radius: 4px
		display: block
		box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.1)

	// === Size Section ===
	.pp-size-section
		display: flex
		flex-direction: column
		gap: 0.5rem

	.pp-sizes
		display: flex
		flex-wrap: wrap
		gap: 0.5rem
		align-items: center

	.size-option
		display: flex
		align-items: center
		justify-content: center
		min-width: 44px
		height: 44px
		padding: 0 0.75rem
		border-radius: 8px
		border: 1px solid var(--border-color)
		cursor: pointer
		font-size: 0.9rem
		font-weight: 600
		color: var(--text-color)
		background-color: transparent
		transition: all 0.2s ease

		&:hover
			border-color: var(--primary-color)
			color: var(--primary-color)

		&.selected
			background-color: var(--primary-color)
			border-color: var(--primary-color)
			color: #fff

	// === Actions ===
	.pp-actions
		display: flex
		align-items: center
		justify-content: space-between
		margin-top: 1rem
		padding-top: 1.5rem
		border-top: 1px solid var(--border-color)
		gap: 1.5rem

		.price-block
			display: flex
			flex-direction: column

			.label
				font-size: 0.75rem
				color: var(--secondary-text-color)
				margin-bottom: 0.25rem

			.price
				font-size: 2rem
				font-weight: 700
				color: var(--text-color)

		.action-buttons
			display: flex
			gap: 0.75rem
			align-items: center

	// === Delivery Info ===
	.pp-delivery
		display: flex
		flex-direction: column
		gap: 1rem
		padding: 1.25rem
		background-color: var(--secondary-bg)
		border-radius: 12px
		border: 1px solid var(--border-color)

	.delivery-item
		display: flex
		align-items: flex-start
		gap: 1rem

	.delivery-icon
		width: 40px
		height: 40px
		border-radius: 8px
		background-color: var(--bg-color)
		display: flex
		align-items: center
		justify-content: center
		color: var(--primary-color)
		flex-shrink: 0

	.delivery-content
		display: flex
		flex-direction: column
		gap: 0.25rem

		.delivery-title
			font-weight: 600
			font-size: 0.9rem
			color: var(--text-color)

		.delivery-text
			font-size: 0.8rem
			color: var(--secondary-text-color)

			a
				color: var(--primary-color)
				text-decoration: underline

	// === Product Features ===
	.pp-features
		display: flex
		flex-wrap: wrap
		gap: 1rem

	.feature-item
		display: flex
		align-items: center
		gap: 0.5rem
		padding: 0.5rem 1rem
		background-color: var(--secondary-bg)
		border-radius: 8px
		font-size: 0.85rem
		color: var(--secondary-text-color)

		[data-icon]
			color: var(--primary-color)
</style>

<script>
	// Size Selection Logic
	const initSizeSelector = () => {
		const sizeOptions = document.querySelectorAll(".size-option");
		sizeOptions.forEach((option) => {
			option.addEventListener("click", () => {
				sizeOptions.forEach((o) => o.classList.remove("selected"));
				option.classList.add("selected");
			});
		});
	};

	// Thumbnail Selection
	const initThumbnails = () => {
		const thumbnails = document.querySelectorAll(".pp-thumbnail");
		const mainImage = document.getElementById(
			"main-product-image",
		) as HTMLImageElement;
		const indicators = document.querySelectorAll(
			".gallery-indicators .indicator",
		);

		thumbnails.forEach((thumb, index) => {
			thumb.addEventListener("click", () => {
				thumbnails.forEach((t) => t.classList.remove("active"));
				thumb.classList.add("active");

				// Update indicators
				indicators.forEach((ind, i) => {
					ind.classList.toggle("active", i === index);
				});

				const thumbImg = thumb.querySelector("img") as HTMLImageElement;
				if (thumbImg && mainImage) {
					mainImage.src = thumbImg.src;
				}
			});
		});

		// Indicator clicks
		indicators.forEach((ind, index) => {
			ind.addEventListener("click", () => {
				if (thumbnails[index]) {
					(thumbnails[index] as HTMLElement).click();
				}
			});
		});
	};

	// Color Selection Logic
	const initColorSelector = () => {
		const colorOptions = document.querySelectorAll(".color-option");
		const mainImage = document.getElementById(
			"main-product-image",
		) as HTMLImageElement;

		colorOptions.forEach((option) => {
			option.addEventListener("click", () => {
				colorOptions.forEach((o) => o.classList.remove("active"));
				option.classList.add("active");

				// Update main image with color variant
				const variantImg = option.querySelector("img") as HTMLImageElement;
				if (variantImg && mainImage) {
					mainImage.src = variantImg.src;
				}
			});
		});
	};

	// Initialize
	const initProductPage = () => {
		initSizeSelector();
		initThumbnails();
		initColorSelector();
	};

	initProductPage();
	document.addEventListener("astro:page-load", initProductPage);
</script>
